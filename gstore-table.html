<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>列表视图 - 知识图谱管理系统 Powered by gStore</title>

    <!-- Bootstrap Styles-->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FontAwesome Styles-->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
    <!-- Morris Chart Styles-->

    <!-- Custom Styles-->
    <link href="assets/css/custom-styles.css" rel="stylesheet" />
    <!-- Google Fonts-->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />
    <!-- TABLE STYLES-->
    <link href="assets/js/dataTables/dataTables.bootstrap.css" rel="stylesheet" />
</head>

<body>
    <div id="wrapper">
        <nav class="navbar navbar-default top-navbar" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">gStore</a>
            </div>
        </nav>
        <!--/. NAV TOP  -->

        <nav class="navbar-default navbar-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav" id="main-menu">
                    <li>
                        <a id="a-dash" href="gstore-dashboard.html"><i class="fa fa-fw fa-file"></i> 控制面板 </a>
                    </li>
                    <li>
                        <a id="a-tb" href="gstore-table.html" class="active-menu"><i class="fa fa-fw fa-file"></i> 列表视图 </a>
                    </li>
                    <li>
                        <a id="a-gr" href="gstore-graph.html"><i class="fa fa-fw fa-file"></i> 图谱视图 </a>
                    </li>
                    <li>
                        <a id="a-dt" href="gstore-entity.html"><i class="fa fa-fw fa-file"></i> 知识元详情 </a>
                    </li>
                    <li>
                        <a id="a-sp" href="gstore-sparql.html"><i class="fa fa-fw fa-file"></i> SPARQL查询 </a>
                    </li>
                    <li>
                        <a id="a-hp" href="gstore-help.html"><i class="fa fa-fw fa-file"></i> 帮助 </a>
                    </li>
                </ul>
            </div>
        </nav>
        <!-- /. NAV SIDE  -->

        <div id="page-wrapper">
            <div id="page-inner">

                <div class="row">
                    <div class="col-md-12">
                        <h3 class="page-header">
                            数据集：<span id="p-db-name">null</span>
                        </h3>
                    </div>
                </div>
                <!-- /. ROW  -->

                <div class="row">
                    <div class="col-xs-12">
                        <div id="alert-add-success" class="alert alert-success">
                            <strong>知识元添加成功</strong>
                        </div>
                        <div id="alert-add-fail" class="alert alert-danger">
                            <strong>知识元添加失败</strong>
                        </div>
                        <div id="alert-del-success" class="alert alert-success">
                            <strong>知识元删除成功</strong>
                        </div>
                        <div id="alert-del-fail" class="alert alert-danger">
                            <strong>知识元删除失败</strong>
                        </div>
                        <div id="alert-upd-success" class="alert alert-success">
                            <strong>知识元更新成功</strong>
                        </div>
                        <div id="alert-upd-fail" class="alert alert-danger">
                            <strong>知识元更新失败</strong>
                        </div>
                    </div>
                </div>


                <div class="row">
                    <div class="col-xs-12">
                        <div class="panel panel-default panel-table">

                            <div class="panel-heading">
                                <div class="row">
                                    <div class="col col-sm-6">
                                        <h3 class="panel-title">知识元列表</h3>
                                    </div>
                                    <div class="col col-sm-6 text-right">
                                        <button class="btn btn-info btn-sm btn-create" data-title="Delete" data-toggle="modal" data-target="#insert"><span class="glyphicon glyphicon-plus-sign"></span> <span>新建</span> </button>
                                        <button class="btn btn-info btn-sm btn-filter" id="my-btn-filter"><span class="glyphicon glyphicon-filter"></span> <span>筛选</span> </button>
                                    </div>
                                </div>
                            </div>
                            <!-- /. PANEL HEADING  -->

                            <div class="panel-body">
                                <table id="mytable" class="table table-bordered table-striped table-hover">
                                    <thead>
                                        <tr id="tr-input">
                                            <td><input id="td-input1" type="text" class="form-control" placeholder="筛选 名称" /></td>
                                            <td><input id="td-input2" type="text" class="form-control" placeholder="筛选 简介" /></td>
                                            <td colspan="2"><a class="btn btn-default btn-block" id="search-submit"><span class="glyphicon glyphicon-search"></span> 搜索</a></td>
                                        </tr>
                                        <tr>
                                            <td><strong>名称</strong></td>
                                            <td><strong>简介</strong></td>
                                            <td align="center"><strong>编辑</strong></td>
                                            <td align="center"><strong>删除</strong></td>
                                            <td><strong>Time</strong></td>
                                        </tr>
                                    </thead>

                                    <tbody id="mytbody"> </tbody>

                                </table>

                            </div>
                            <!-- /. PANEL BODY  -->

                            <!--<div class="panel-footer">
                                <div class="row">
                                    <div class="col col-xs-4">Page 1 of 5</div>
                                    <div class="col col-xs-12">
                                        <ul class="pagination hidden-xs pull-right">
                                            <li class="disabled"><a href="#"><span class="glyphicon glyphicon-chevron-left"></span></a></li>
                                            <li class="active"><a href="#">1</a></li>
                                            <li><a href="#">2</a></li>
                                            <li><a href="#">3</a></li>
                                            <li><a href="#">4</a></li>
                                            <li><a href="#">5</a></li>
                                            <li><a href="#"><span class="glyphicon glyphicon-chevron-right"></span></a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>-->
                            <!-- /. PANEL FOOTER  -->

                        </div>
                        <!-- /. PANEL TABLE  -->


                        <div class="modal fade" id="insert" tabindex="-1" role="dialog" aria-labelledby="insert" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">

                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span class="glyphicon glyphicon-insert" aria-hidden="true"></span></button>
                                        <h4 class="modal-title custom_align" id="Heading">新建知识元</h4>
                                    </div>

                                    <div class="modal-body">
                                        <div class="form-group">
                                            <label class="control-label" for="insert-title">名称</label>
                                            <input id="insert-title" class="form-control " type="text" placeholder="名称不能为空">
                                            <!-- disabled -->
                                        </div>

                                        <div class="form-group">
                                            <label class="control-label" for="insert-description">简介</label>
                                            <textarea id="insert-description" rows="3" class="form-control" placeholder="在这里填写知识元简介"></textarea>
                                        </div>
                                    </div>

                                    <div class="modal-footer ">
                                        <button type="button" class="btn btn-warning btn-lg" id="confirm-insert" data-dismiss="modal" style="width: 100%;"><span class="glyphicon glyphicon-ok-sign"></span> 新建</button>
                                    </div>
                                </div>
                                <!-- /.modal-content -->
                            </div>
                            <!-- /.modal-dialog -->
                        </div>



                        <div class="modal fade" id="edit" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">

                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                                        <h4 class="modal-title custom_align" id="Heading">编辑知识元</h4>
                                    </div>

                                    <div class="modal-body">
                                        <div class="form-group">
                                            <label class="control-label" for="edit-title">名称</label>
                                            <input id="edit-title" class="form-control " type="text" placeholder="Title">
                                            <!-- disabled -->
                                        </div>

                                        <div class="form-group">
                                            <label class="control-label" for="edit-description">简介</label>
                                            <textarea id="edit-description" rows="3" class="form-control" placeholder="Descrition"></textarea>
                                        </div>
                                    </div>

                                    <div class="modal-footer ">
                                        <button type="button" class="btn btn-warning btn-lg" id="confirm-update" data-dismiss="modal" style="width: 100%;"><span class="glyphicon glyphicon-ok-sign"></span> 更新</button>
                                    </div>
                                </div>
                                <!-- /.modal-content -->
                            </div>
                            <!-- /.modal-dialog -->
                        </div>


                        <div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">

                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                                        <h4 class="modal-title custom_align" id="Heading">删除知识元</h4>
                                    </div>

                                    <div class="modal-body">

                                        <div class="alert alert-danger"><span class="glyphicon glyphicon-warning-sign"></span> 即将删除这条知识元，以及相关的知识元关系链接，确定吗？</div>
                                        <div>
                                            <p id="dp-title">null</p>
                                        </div>
                                    </div>

                                    <div class="modal-footer ">
                                        <button type="button" class="btn btn-success" id="confirm-delete" data-dismiss="modal"><span class="glyphicon glyphicon-ok-sign"></span> 是</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> 否</button>
                                    </div>
                                </div>
                                <!-- /.modal-content -->
                            </div>
                            <!-- /.modal-dialog -->
                        </div>

                    </div>
                    <!-- /. ROW  -->
                </div>
                <footer>
                    <p>All right reserved. Template by: <a href="http://webthemez.com">WebThemez</a></p>
                </footer>
            </div>
            <!-- /. PAGE INNER  -->
        </div>
        <!-- /. PAGE WRAPPER  -->
        <!-- /. WRAPPER  -->
        <!-- JS Scripts-->
        <!-- jQuery Js -->
        <script src="assets/js/jquery-1.10.2.js"></script>
        <!-- Bootstrap Js -->
        <script src="assets/js/bootstrap.min.js"></script>
        <!-- Metis Menu Js -->
        <script src="assets/js/jquery.metisMenu.js"></script>
        <!-- DATA TABLE SCRIPTS -->
        <script src="assets/js/dataTables/jquery.dataTables.js"></script>
        <script src="assets/js/dataTables/dataTables.bootstrap.js"></script>
        <!-- Custom Js -->
        <script src="assets/js/gstore-util.js"></script>
        <script src="assets/js/gstore-table.js"></script>
        <script src="assets/js/gstore-gstore.js"></script>

        <script>
            $(document).ready(function () {

                // hide alerts
                [
                    '#alert-add-success',
                    '#alert-add-fail',
                    '#alert-del-success',
                    '#alert-del-fail',
                    '#alert-upd-success',
                    '#alert-upd-fail'
                ].map(e => $(e).hide());

                // parse urls
                var params = parseURL(document.URL);
                if (Object.keys(params).length > 0) {
                    global_ip = params["ip"];
                    global_port = params["port"];
                    global_dbname = params["db"];

                    // set urls
                    [
                        "#a-dash",
                        "#a-tb",
                        "#a-gr",
                        "#a-dt",
                        "#a-sp",
                        "#a-hp"
                    ].map(e => $(e)[0].href = getURL($(e)[0].href, { "ip": global_ip, "port": global_port, "db": global_dbname }));
                }

                // initialize datatable object
                $('#mytable').dataTable({
                    // "ordering": false,
                    "searching": false,
                    "columnDefs": [
                        { "width": "6%", "targets": 0 },
                        { "width": "80%", "targets": 1 },
                        { "width": "6%", "targets": 2 },
                        { "width": "6%", "targets": 3 },
                        {
                            "targets": [4],
                            "visible": false,
                            "searchable": false
                        }
                    ],
                    "order": [[4, "desc"]]
                });

                var table = $('#mytable').DataTable();

                // initialize table data
                if (global_dbname == "null") {
                    alert("请先打开服务器(bin/ghttp)，并在\"控制面板\"中配置服务器和数据集参数");
                } else {
                    loadTable(
                        table,
                        $('#td-input1')[0].value.trim(),
                        $('#td-input2')[0].value.trim(),
                        100
                    );
                }

                // initialize dataset name
                $("#p-db-name").text(global_dbname);

                // var dataTable = $('#mytable').DataTable();

                // $('input', '#td-input1').on('keyup change', function () {
                // if (that.search() !== this.value) {
                //     that
                //         .search(this.value)
                //         .draw();
                // }
                // });

                // $('input', '#td-input2').on('keyup change', function () {
                // if (that.search() !== this.value) {
                //     that
                //         .search(this.value)
                //         .draw();
                // }
                // });

                // $("#mytable #checkall").click(function () {
                //     if ($("#mytable #checkall").is(':checked')) {
                //         $("#mytable input[type=checkbox]").each(function () {
                //             $(this).prop("checked", true);
                //         });

                //     } else {
                //         $("#mytable input[type=checkbox]").each(function () {
                //             $(this).prop("checked", false);
                //         });
                //     }
                // });

                // $("[data-toggle=tooltip]").tooltip();

                $("#delete").on("show.bs.modal", function (e) {
                    buttonId = $(e.relatedTarget).data("id");

                    var tr = $("#mytable tr td button.btn-danger[data-id=" + buttonId + "]").parents('tr')
                    var titlePlaceholder = tr.find('td:first-child').text();

                    $('#dp-title').html("<strong>名称</strong>：[" + titlePlaceholder + "]")
                });

                $("#edit").on("show.bs.modal", function (e) {
                    buttonId = $(e.relatedTarget).data("id");

                    var tr = $("#mytable tr td button.btn-primary[data-id=" + buttonId + "]").parents('tr')
                    var titlePlaceholder = tr.find('td:first-child').text();
                    var descPlaceholder = tr.find('td:nth-child(2)').text();

                    $('#edit-title').attr('placeholder', titlePlaceholder)
                    $('#edit-description').attr('placeholder', descPlaceholder)
                    $('#edit-title')[0].value = titlePlaceholder
                    $('#edit-description')[0].value = descPlaceholder

                });

                $("#confirm-insert").click(function () {
                    var title = $("#insert-title")[0].value.trim();
                    var description = $("#insert-description")[0].value.trim();

                    doInsertRow(
                        $('#mytable').DataTable(),
                        title,
                        description,
                        function () {
                            var alertSuccess = $('#alert-add-success');
                            alertSuccess.show();
                            alertSuccess.fadeOut(2000);
                        },
                        function () {
                            var alertFail = $('#alert-add-fail');
                            alertFail.show();
                            alertFail.fadeOut(4000);
                        });

                    $("#insert-title")[0].value = "";
                    $("#insert-description")[0].value = "";
                });

                $("#confirm-delete").click(function () {
                    var tr = $("#mytable tr td button.btn-danger[data-id=" + buttonId + "]").parents('tr');
                    doDelRow(
                        $('#mytable').DataTable(),
                        tr,
                        function () {
                            var alertSuccess = $('#alert-del-success');
                            alertSuccess.show();
                            alertSuccess.fadeOut(2000);
                        },
                        function () {
                            var alertFail = $('#alert-del-fail');
                            alertFail.show();
                            alertFail.fadeOut(4000);
                        },
                    );
                });

                $("#confirm-update").click(function () {
                    var tr = $("#mytable tr td button.btn-primary[data-id=" + buttonId + "]").parents('tr')

                    var title = $("#edit-title")[0].value.trim();
                    var description = $("#edit-description")[0].value.trim();
                    // console.log(title);
                    // console.log(description);

                    if ($('#edit-title').attr('placeholder') == title
                        && $('#edit-description').attr('placeholder') == description) {
                        // console.log('no change');                
                    } else {
                        // console.log('changed');                
                        doUpdateRow(
                            $('#mytable').DataTable(),
                            tr,
                            title,
                            description,
                            function () {
                                var alertSuccess = $('#alert-upd-success');
                                alertSuccess.show();
                                alertSuccess.fadeOut(2000);
                            },
                            function () {
                                var alertSuccess = $('#alert-upd-success');
                                alertSuccess.show();
                                alertSuccess.fadeOut(2000);
                            }
                        );
                    }

                });

                $('#tr-input').hide();

                $('#my-btn-filter').click(function () {
                    $('#tr-input').toggle();

                    var disp = $('#my-btn-filter span:last-child').text();
                    if (disp == '筛选') {
                        disp = '取消筛选';
                    } else {
                        disp = '筛选';
                    }
                    $('#my-btn-filter span:last-child').text(disp);
                });

                $('#search-submit').click(function () {
                    var title = $('#td-input1')[0].value.trim();
                    var intro = $('#td-input2')[0].value.trim();

                    var mytb = $('#mytable').DataTable();
                    mytb.clear();

                    var mbody = $("#mytbody");
                    mbody.empty();

                    loadTable(
                        table,
                        title,
                        intro,
                        100
                    );
                });

            });
        </script>

</body>

</html>